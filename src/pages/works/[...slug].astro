---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import { GALLERY_CONFIG } from '../../config';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
    const works = await getCollection('works');
    return works.map(work => ({
        params: { slug: work.slug },
        props: { work },
    }));
}) satisfies GetStaticPaths;

const { work } = Astro.props;
const { Content } = await work.render();
---

<BaseLayout title={work.data.title} description={`View ${work.data.title} by Peter Mitten`}>
    <div class="work-detail">
        <h1>{work.data.title}</h1>

        <Image
            src={work.data.image}
            alt={work.data.title}
            class="work-image"
            width={GALLERY_CONFIG.fullsize.width}
            height={GALLERY_CONFIG.fullsize.height}
            quality={GALLERY_CONFIG.fullsize.quality}
            inferSize={true}
        />

        <div class="work-meta">
            {work.data.year && (
                <div class="meta-item">
                    <strong>Year</strong>
                    <span>{work.data.year}</span>
                </div>
            )}
            {work.data.category && (
                <div class="meta-item">
                    <strong>Category</strong>
                    <span style="text-transform: capitalize">{work.data.category}</span>
                </div>
            )}
            {work.data.materials && (
                <div class="meta-item">
                    <strong>Materials</strong>
                    <span>{work.data.materials}</span>
                </div>
            )}
            {work.data.dimensions && (
                <div class="meta-item">
                    <strong>Dimensions</strong>
                    <span>{work.data.dimensions}</span>
                </div>
            )}
            {work.data.location && (
                <div class="meta-item">
                    <strong>Location</strong>
                    <span>{work.data.location}</span>
                </div>
            )}
            {work.data.price && !work.data.sold && (
                <div class="meta-item">
                    <strong>Price</strong>
                    <span>{work.data.price}</span>
                </div>
            )}
            {work.data.sold && (
                <div class="meta-item">
                    <strong>Status</strong>
                    <span>Sold</span>
                </div>
            )}
            {work.data.series && (
                <div class="meta-item">
                    <strong>Series</strong>
                    <span>{work.data.series}</span>
                </div>
            )}
        </div>

        <div class="work-description">
            <Content />
        </div>

        {work.data.gallery_images && work.data.gallery_images.length > 0 && (
            <div class="gallery-images">
                <h2>Additional Images</h2>
                <div class="image-grid">
                    {work.data.gallery_images.map((image: string | { src: string, alt: string }) => {
                        const src = typeof image === 'string' ? image : image.src;
                        const alt = typeof image === 'string' ? `${work.data.title} - detail` : image.alt;
                        return <Image src={src} alt={alt} width={GALLERY_CONFIG.galleryImages.width} height={GALLERY_CONFIG.galleryImages.height} quality={GALLERY_CONFIG.galleryImages.quality} loading="lazy" inferSize={true} />;
                    })}
                </div>
            </div>
        )}

        <div class="back-link">
            <a href="/gallery/">&larr; Back to Gallery</a>
        </div>
    </div>
</BaseLayout>

<style lang="scss">
.gallery-images {
    margin-top: 3rem;

    h2 {
        margin-bottom: 1.5rem;
    }

    .image-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;

        img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
        }
    }
}

.back-link {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);

    a {
        font-size: 1.125rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;

        &:hover {
            text-decoration: underline;
        }
    }
}
</style>
